name: Random Domain Visit

on:
  schedule:
    # UTCæ—¶é—´ï¼Œéœ€æ ¹æ®ä½ çš„æ—¶åŒºè°ƒæ•´
    # ä¸­å›½æ—¶åŒº(UTC+8): ä¸­åˆ12ç‚¹ = UTC 04:00, æ™šä¸Š12ç‚¹ = UTC 16:00
    - cron: '58 3 * * *'   # ä¸­åˆ12ç‚¹å‰2åˆ†é’Ÿ (UTC)
    - cron: '58 15 * * *'  # æ™šä¸Š12ç‚¹å‰2åˆ†é’Ÿ (UTC)
  workflow_dispatch:

jobs:
  visit-domains:
    runs-on: ubuntu-latest
    
    steps:
      - name: Random Domain Visit
        run: |
          #!/bin/bash
          set -e
          
          # åŸŸååˆ—è¡¨
          domains=(
            "ycenzh.ip-ddns.com"
            "cname.abrdns.com"
            "first.abrdns.com"
            "github.abrdns.com"
            "sakura.cloud-ip.cc"
            "ycenzh.abrdns.com"
            "ycenzh.ddns-ip.net"
            "ycenzh.github.io"
            "fuwari.oh1.top"
          )
          
          # æµè§ˆå™¨ User-Agent åˆ—è¡¨
          user_agents=(
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
            "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0"
            "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15"
            "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
            "Mozilla/5.0 (iPhone; CPU iPhone OS 17_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Mobile/15E148 Safari/604.1"
          )
          
          # éšæœºå»¶è¿Ÿ 0-240 ç§’ï¼ˆå‰å2åˆ†é’Ÿå†…éšæœºï¼‰
          delay=$((RANDOM % 241))
          echo "â° éšæœºå»¶è¿Ÿ ${delay} ç§’åå¼€å§‹è®¿é—®..."
          sleep ${delay}
          
          # éšæœºé€‰æ‹©è®¿é—® 1 æˆ– 2 ä¸ªåŸŸå
          visit_count=$((RANDOM % 2 + 1))
          echo "ğŸ¯ æœ¬æ¬¡å°†è®¿é—® ${visit_count} ä¸ªåŸŸå"
          echo ""
          
          # æ‰“ä¹±åŸŸåæ•°ç»„
          shuffled_domains=($(printf '%s\n' "${domains[@]}" | shuf))
          
          # è®¿é—®é€‰ä¸­çš„åŸŸå
          for i in $(seq 1 ${visit_count}); do
            domain=${shuffled_domains[$((i-1))]}
            
            # éšæœºé€‰æ‹©ä¸€ä¸ª User-Agent
            ua=${user_agents[$RANDOM % ${#user_agents[@]}]}
            
            # éšæœºé€‰æ‹©åè®® (http/https)
            if [ $((RANDOM % 10)) -lt 8 ]; then
              protocol="https"
            else
              protocol="http"
            fi
            url="${protocol}://${domain}"
            
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "ğŸŒ è®¿é—®åŸŸå #${i}: ${url}"
            echo "ğŸ”§ User-Agent: ${ua:0:50}..."
            
            # æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è®¿é—®
            response=$(curl -s -L -w "\n%{http_code}|%{time_total}|%{time_namelookup}" \
              -H "User-Agent: ${ua}" \
              -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8" \
              -H "Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-US;q=0.7" \
              -H "Accept-Encoding: gzip, deflate, br" \
              -H "DNT: 1" \
              -H "Connection: keep-alive" \
              -H "Upgrade-Insecure-Requests: 1" \
              -H "Sec-Fetch-Dest: document" \
              -H "Sec-Fetch-Mode: navigate" \
              -H "Sec-Fetch-Site: none" \
              -H "Sec-Fetch-User: ?1" \
              -H "Cache-Control: max-age=0" \
              -H "Referer: https://www.google.com/" \
              --compressed \
              --connect-timeout 15 \
              --max-time 30 \
              "${url}" 2>&1) || true
            
            # è§£æå“åº”
            stats=$(echo "$response" | tail -n 1)
            http_code=$(echo "$stats" | cut -d'|' -f1)
            time_total=$(echo "$stats" | cut -d'|' -f2)
            time_dns=$(echo "$stats" | cut -d'|' -f3)
            
            if [[ "$http_code" =~ ^[0-9]+$ ]]; then
              echo "âœ… HTTPçŠ¶æ€ç : ${http_code}"
              echo "â±ï¸  æ€»è€—æ—¶: ${time_total}s | DNSè§£æ: ${time_dns}s"
            else
              echo "âŒ è®¿é—®å¤±è´¥"
            fi
            
            # å¦‚æœè¿˜æœ‰ä¸‹ä¸€ä¸ªåŸŸåï¼Œéšæœºç­‰å¾… 3-10 ç§’
            if [ ${i} -lt ${visit_count} ]; then
              interval=$((RANDOM % 8 + 3))
              echo ""
              echo "â³ ç­‰å¾… ${interval} ç§’åè®¿é—®ä¸‹ä¸€ä¸ªåŸŸå..."
              sleep ${interval}
              echo ""
            fi
          done
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ¨ æ‰€æœ‰è®¿é—®ä»»åŠ¡å®Œæˆï¼"
          echo "ğŸ“… å®Œæˆæ—¶é—´: $(TZ=Asia/Shanghai date '+%Y-%m-%d %H:%M:%S %Z')"
        shell: bash
